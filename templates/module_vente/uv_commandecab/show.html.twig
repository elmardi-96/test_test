{% extends 'base_ugouv.html.twig' %}


{% block title %}Commande | Vente
{% endblock %}

{% block body %}
<div class="modal fade right" id="livraisonPopUp" tabindex="-1" role="dialog" aria-labelledby="exampleModalPreviewLabel" data-backdrop="false" style="" aria-hidden="true">
	<div class="modal-dialog modal-full-height modal-right modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h3 class="modal-title" id="exampleModalPreviewLabel">Generer Livraison</h3>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">×</span>
				</button>
			</div>
			<div class="modal-body bo">
				<div class="text-center spr" style="display: none;">
					<div class="spinner-border" role="status">
						<span class="sr-only">Loading...</span>
					</div>
				</div>
				<div class="bod" style=""></div>
			</div>
		</div>
	</div>
</div>

<div class="actions modal fade right" id="ModalDocumentDynamique" tabindex="-1" role="dialog" aria-labelledby="exampleModalPreviewLabel" aria-hidden="false" data-backdrop='false'>
	<div class="modal-dialog  modal-full-height modal-middle modal-right modal-sm " style="max-width:400 px;" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalPreviewLabel">Ajouter fichier/DOCUMENT/IMAGE</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body bo-0">
				<div class="text-center spr1">
					<br/>
					<div class="spinner-border" role="status">
						<span class="sr-only">Loading...</span>
					</div>
				</div>
				<div class="bod1"></div>
			</div>

		</div>
	</div>
</div>




<div class="modal fade right" id="typePopUp" tabindex="-1" role="dialog" aria-labelledby="exampleModalPreviewLabel" data-backdrop="false" style="" aria-hidden="true">
	<div class="modal-dialog modal-full-height modal-right modal-sm " role="document">


		<div class="modal-content">
			<div class="modal-header">
				<h3 class="modal-title" id="exampleModalPreviewLabel">Type commande</h3>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">×</span>
				</button>
			</div>
			<div class="modal-body bo">
				<div class="text-center spr2" style="display: none;">
					<div class="spinner-border" role="status">
						<span class="sr-only">Loading...</span>
					</div>
				</div>
				<div class="bod2" style=""></div>
			</div>
		</div>
	</div>
</div>
	{{ parent() }}




	<div id="right-sidebar" class="actions animated"></div>


	<div class="row wrapper  white-bg page-heading  fixed-top-navigation-button">
		<div class="col-lg-12">
		
            {{ include('./module_vente/uv_commandecab/inc/workflow_breadcumb.html.twig' ,{'page_actuel': 'show'}) }}
		</div>

		<div class="border-b"></div>
		<div class="col-lg-12">
			{{ wo_render_breadcrumbs() }}
		</div>
	</div>
	<br/><br/>
	<div class="wrapper wrapper-content  animated fadeInRight p-r-l-0">
		<div class="row">
			<div class="col-10 no-pad-right no-pad-left ">
				<div class="ibox">
					<div class="ibox-content p-b-0">
						<h4>informations generales


							<span class="f-r hint--bottom-left" aria-label="{{ commande.positionActuel }}">
								<i class=" f-r fa fa-circle wf-color wf-color-{{ commande.positionActuel }} "></i>
							</span>


						</h4>
						<div class="row">
							<div class="col-md-12">
								<div class="panel blank-panel">

									<div class="col-md-12 p-t-0">
										<div class="panel-body">

											<div class="tab-content">
												<div class="tab-pane active show" id="tab-1">
													<div class="row">
														<div class="col-md-6 b-r">
															

                                                            <div class="form-group row ph">
                                                                <label class="col-sm-4 required font-weight-bold font-weight-bold">Id</label>

                                                                <div class="col-sm-8">
                                                                    <p class="form-control-static">{{ commande.id }}</p>
                                                                </div>

                                                            </div>
                                                            

                                                            <div class="form-group row ph">
                                                                <label class="col-sm-4 required font-weight-bold font-weight-bold">Code</label>

                                                                <div class="col-sm-8">
                                                                    <p class="form-control-static">{{ commande.code }}</p>
                                                                </div>

                                                            </div>
                                                            
                                                            <div class="form-group row ph">
                                                                <label class="col-sm-4 required font-weight-bold">DATE Commande  </label>

                                                                <div class="col-sm-8">
                                                                    <p class="form-control-static">{{ commande.dateDevis|date("d/m/Y") }}</p>
                                                                </div>

                                                            </div>
                                                           {#} 
                                                            <div class="form-group row ph">
                                                                <label class="col-sm-4 required font-weight-bold">TYPE :</label>

                                                                <div class="col-sm-8">
                                                                    <p class="form-control-static">{{ commande.type ? commande.type.designation }}</p>
                                                                </div>

                                                            </div>#}


                                                            {% if commande.type %}
                                                                {% if commande.type.code == 'PRJ' %}


                                                                    
                                                                    <div class="form-group row ph">
                                                                        <label class="col-sm-4 required font-weight-bold">PROJET </label>

                                                                        <div class="col-sm-8">
                                                                            <p class="form-control-static">{{ commande.projet ? commande.projet.designation }}</p>
                                                                        </div>

                                                                    </div>
                                                                    
                                                                    <div class="form-group row ph">
                                                                        <label class="col-sm-4 required font-weight-bold">SOUS PROJET </label>

                                                                        <div class="col-sm-8">
                                                                            <p class="form-control-static">{{ commande.sousprojet ? commande.sousprojet.designation }}</p>
                                                                        </div>

                                                                    </div>

                                                                {% endif %}

                                                            {% endif %}

                                                            {% if commande.type %}
                                                                {% if commande.type.code == 'MR' %}


                                                                    
                                                                    <div class="form-group row ph">
                                                                        <label class="col-sm-4 required font-weight-bold">MARCHe  </label>

                                                                        <div class="col-sm-8">
                                                                            <p class="form-control-static">{{ commande.marche ? commande.marche.designation }}</p>
                                                                        </div>

                                                                    </div>
                                                                    
                                                                    <div class="form-group row ph">
                                                                        <label class="col-sm-4 required font-weight-bold">SOUS MARCHe </label>

                                                                        <div class="col-sm-8">
                                                                            <p class="form-control-static">{{ commande.marchesous ? commande.marchesous.designation }}</p>
                                                                        </div>

                                                                    </div>

                                                                {% endif %}

                                                            {% endif %}


                                                            {% if commande.type %}
                                                                {% if commande.type.code == 'CMD' %}


                                                                    
                                                                    <div class="form-group row ph">
                                                                        <label class="col-sm-4 required font-weight-bold">Reference commande client  </label>

                                                                        <div class="col-sm-8">
                                                                            <p class="form-control-static">{{ commande.devisClient ? commande.devisClient.code }}</p>
                                                                        </div>

                                                                    </div>


                                                                {% endif %}

                                                            {% endif %}


                                                            
                                                            <div class="form-group row ph">
                                                                <label class="col-sm-4 required font-weight-bold">CLIENT </label>

                                                                <div class="col-sm-8">
                                                                    <p class="form-control-static">{{ commande.client ?  commande.client.societe }}</p>
                                                                </div>

                                                            </div>

															<div class="form-group row ph">
                                                                <label class="col-sm-4 required font-weight-bold">type </label>

                                                                <div class="col-sm-8">
                                                                    <p class="form-control-static">{{ commande.typecmd ?  commande.typecmd.v }}</p>
                                                                </div>

                                                            </div>
															

                                                            
                                                            <div class="form-group row ph">
                                                                <label class="col-sm-4 required font-weight-bold">DESCRIPTION  </label>

                                                                <div class="col-sm-8">
                                                                    <p class="form-control-static">{{ commande.description  }}</p>
                                                                </div>

                                                            </div>
                                                           
                                                            
                                                            <div class="form-group row ph">
                                                                <label class="col-sm-4 required font-weight-bold">DEVISE </label>

                                                                <div class="col-sm-8">
                                                                    <p class="form-control-static">{{ commande.devise ?  commande.devise.designation}}</p>
                                                                </div>

                                                            </div>
														</div>
														<div
															class="col-md-6">
															<div class="form-group row ph">
                                                                <label class="col-sm-4 required font-weight-bold">ReF COMMANDE </label>

                                                                <div class="col-sm-8">
                                                                    <p class="form-control-static">{{ commande.refCommande }}</p>
                                                                </div>

                                                            </div>

                                                            
                                                            <div class="form-group row ph">
                                                                <label class="col-sm-4 required font-weight-bold">DATE COMMANDE </label>

                                                                <div class="col-sm-8">
                                                                    <p class="form-control-static">{{ commande.dateCommande|date("d/m/Y") }}</p>
                                                                </div>

                                                            </div>
                                                            
                                                            <div class="form-group row ph">
                                                                <label class="col-sm-4 required font-weight-bold">BUDGET </label>

                                                                <div class="col-sm-8">
                                                                    <p class="form-control-static">


                                                                        {{ commande.budget|number_format(2)  }}


                                                                    </p>
                                                                </div>

                                                            </div>
                                                            
                                                            <div class="form-group row ph">
                                                                <label class="col-sm-4 required font-weight-bold">DEPENSEE </label>

                                                                <div class="col-sm-8">
                                                                    <p class="form-control-static">{{ commande.depenser }}</p>
                                                                </div>

                                                            </div>
                                                            
                                                            <div class="form-group row ph">
                                                                <label class="col-sm-4 required font-weight-bold">DESCRIPTION DeTAIL </label>

                                                                <div class="col-sm-8">
                                                                    <p class="form-control-static">{{ commande.observation }}</p>
                                                                </div>

                                                            </div>

														</div>
													</div>
												</div>


											</div>


										</div>


									</div>
								</div>
							</div>
						</div>


					</div>
				</div>
				<div class="ibox">
					<div class="ibox-content">

						<h4 class="m-b-0">Details</h4>
						<div id="tab-1" class="tab-pane active" style="height:auto">
							<div class="full-height-scroll">
								<div class="table-responsive">

									<table class="t-m table table-striped table-bordered table-hover w-m dataTables-example dataTable">
										<thead class="f-9">
											<tr>
												<th style="width:2%;" class="center">#</th>
                                                <th style="width:5%;" class="center">Reference</th>
                                                <th style="width:40%;" class="center">Article</th>
                                                <th style="width:3%;" class="center">U</th>
                                                <th style="width:5%;" class="center">Quantité</th>
                                                <th style="width:7%;" class="center">Prix unitaire</th>
                                                <th style="width:3%;" class="center">TVA%</th>
                                                <th style="width:8%;" class="center">Montant TVA</th>
                                                <th style="width:5%;" class="center">REMISE%</th>
                                                <th style="width:9%;" class="center">Montant REMISE</th>
                                                <th style="width:5%;" class="center">TOTAL</th>
											</tr>
										</thead>
										<tbody>
											{% for detail  in  commande.details %}
												<tr>
													<td>{{ loop.index }}</td>
													<td>{{detail.article ? detail.article.code :''}}</td>
													<td>
														{{ detail.article ? detail.article.titre:''}}
														{% if detail.observation %}
															<br/><b>Informations complementaires :
																{{ detail.observation}}</b>
														{% endif %}
													</td>
													<td class="center">{{ detail.unite ? detail.unite.abreviation:''}}</td>
													<td class="center">{{ detail.quantiteformat }}</td>
													<td class="text-end">{{ detail.prixunitairefomat }}</td>
													<td class="center">{{detail.tvafomat }}</td>
													<td class="text-end">{{ detail.prixtvaformat }}</td>
													<td class="text-end">{{ detail.remisefomat }}
													</td>
													<td class="text-end">{{ detail.prixremiseformat }}
													</td>
													<td class="text-end-padding">{{detail.prixttcformat }}</td>
												</tr>
											{% endfor %}
										</tbody>
									</table>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
			<div class="col-2 no-pad-left pdr-5">
				<div class="ibox">


					<div class="ibox-content prix_bloc">
						<div class="ibox-heading">
							<h3>Total HT
								<div class="stat-percent">{{ commande.prixht|number_format(2, ',', ' ') }}
									{{commande.devise ? commande.devise.designation}}
								</div>
							</h3>
						</div>
						<hr/>
						<div class="ibox-heading">
							<h3>TOTAL TAXES
								<div class="stat-percent">{{ commande.prixtva|number_format(2, ',', ' ') }}
									{{commande.devise ? commande.devise.designation}}</div>
							</h3>
						</div>
						{% if commande.prixremise > 0 %}
							<hr/>
							<div class="ibox-heading">
								<h3>TOTAL REMISE
									<div class="stat-percent">{{ commande.prixremise|number_format(2, ',', ' ') }}
										{{commande.devise ? commande.devise.designation}}</div>
								</h3>
							</div>
						{% endif %}

						<hr/>
						<div class="ibox-heading">
							<h1>Total T.T.C
								<div class="stat-percent">{{ commande.prixttc|number_format(2, ',', ' ') }}
									{{commande.devise ? commande.devise.designation}}</div>
							</h1>
						</div>
						<hr/>


					</div>
				</div>
				<div class="ibox selected">
					<div class="ibox-content pd-0">
						<div class="tab-content">
							<div id="contact-1" class="tab-pane active">
								<div class="client-detail-">
									<div class="full-height-scroll">


										<ul class="list-group clear-list">
											{% for key ,  operation in operations  %}
												{%  if  operation.prefix == '_documents' %}
													<li class="list-group-item fist-item">
														<div class="panel-default">
															<div class="div-panel-header">
																<h5 class="panel-title p-title-style">
																	<a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" class="collapsed">
																		<i class="fa fa-file-pdf-o"></i>
																		Impressions associé</a>
																</h5>
															</div>
															<div id="collapseOne" class="panel-collapse in collapse">
																<div class="panel-body">
																	<ul class="folder-list m-b-md pd-0-10">
																	    {% if commande.devis %}
                                                                    <li>
                                                                        <a href="{{ path('uv_deviscab_pdf' , {id:commande.devis.id})}}" data-valide="{{commande.statutsig}}" {% if commande.client and commande.client.categorie.k != "externe" %}class="imprime_document" {% endif %} target="_blank">
                                                                            <i class="fa fa-file-pdf-o"></i>
                                                                            Pre-commande ({{ commande.devis.code }})</a>
                                                                    </li>
                                                                {% endif %}
                                                                <li>
                                                                    <a href="{{ path('uv_commandecab_pdf' , {id:commande.id})}}" data-valide="{{commande.statutsig}}" {% if commande.client and commande.client.categorie.k != "externe" %}class="imprime_document" {% endif %} target="_blank">
                                                                        <i class="fa fa-file-pdf-o"></i>
                                                                        commande ({{ commande.code }})</a>
                                                                </li>
																<li>
                                                                    <a href="{{ path('uv_commandecab2_pdf' , {id:commande.id})}}" data-valide="{{commande.statutsig}}" {% if commande.client and commande.client.categorie.k != "externe" %}class="imprime_document" {% endif %} target="_blank">
                                                                        <i class="fa fa-file-pdf-o"></i>
                                                                        commande_DT ({{ commande.code }})</a>
                                                                </li>
																	</ul>


																
																</div>
															</div>
														</div>
													</li>
												{% endif %}


												{%  if  operation.prefix == '_fichiers' %}
													<li class="list-group-item fist-item">
														<div class="panel-default">
															<div class="div-panel-header">
																<h5 class="panel-title p-title-style">
																	<a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" class="collapsed">
																		<i class="fa fa-folder-o"></i>
																		Fichiers associé</a>
																</h5>
															</div>
															<div id="collapseTwo" class="panel-collapse in collapse">
																<div class="panel-body">

																	{% if commande.fichiers is not empty  %}
																		<ul class="list-unstyled file-list">
																			{% for fichier in commande.fichiers %}
																				{% set icon = "fa fa-paperclip" %}
																				{% set extension = fichier.imageName|split('.') %}
																				{% if extension[1] is defined  %}
																					{% if extension[1] in ['png' , 'jpg' , 'jpeg' , 'icon' , 'svg']  %}
																						{% set icon = "fa fa-file-image-o" %}
																					{% elseif extension[1] in ['pdf']  %}
																						{% set icon = "fa fa-file-pdf-o" %}
																					{% elseif extension[1] in ['xls' ,'xlsx']  %}
																						{% set icon = "fa fa-file-excel-o" %}
																					{% elseif extension[1] in ['doc' ,'docs']  %}
																						{% set icon = "fa fa-file-word-o" %}
																					{% elseif extension[1] in ['zip' ,'rar']  %}
																						{% set icon = "fa fa-file-archive-o" %}
																					{% endif  %}
																				{% endif  %}
																				<li>
																					<a href="{{ asset('/images/ugouv/vente/commandevente/fichiers' ~ fichier.imageName) }}">
																						<i class="{{ icon }}"></i>
																						{{ fichier.originalName }}<b style="font-size: 8px ;">
																							<i class="fa fa-clock-o" style="font-size: 10px; margin: 1px 5px 0px 5px"></i>
																							{{ fichier.created ? fichier.created|date('Y-m-d')}}</b>
																					</a>
																					<a class="_delete_fichier" style="float: right; color: red;" id="{{ fichier.id }}">
																						<i class="fa fa-trash"></i>

																					</a>
																				</li>

																			{% endfor %}

																		</ul>
																	{% endif %}
																	<a class="btn btn-white btn-outline btn-xs ajout" id="{{commande.id}}">
																		<i class="fa fa-plus"></i>
																		ajouter
																	</a>

																</div>
															</div>
														</div>
													</li>
												{% endif %}
											{% endfor %}
											<li class="list-group-item fist-item">
                                                <div class="panel-default">
                                                    <div class="div-panel-header">
                                                        <h5 class="panel-title p-title-style">
                                                            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTree" aria-expanded="false" class="collapsed">
                                                                <i class="fa fa-clipboard"></i>
                                                                LIENS ASSOCIé</a>
                                                        </h5>
                                                    </div>

                                                    <div id="collapseTree" class="panel-collapse in collapse">
                                                        <div class="panel-body">
														
															{{ include('./module_vente/inc/flux_devis.html.twig',{'devis': commande.devis ,'commande' : commande, 'active_devis':true}) }}

                                                        </div>
                                                    </div>

												
												

                                                </div>
                                            </li>
										</ul>
										<br/>
									</div>
								</div>
							</div>

						</div>
					</div>
				</div>

			</div>
		</div>
	</div>


	{{ include('./module_vente/uv_commandecab/inc/workflow.html.twig' ,{'page_actuel': 'show'}) }}


	{#{ render(controller('App\\Controller\\ModuleAchat\\UATCommandefrscabController:showhistorique',{ 'commande': commande }))}#}

{% endblock %}

{% block javascripts %}
	{{ parent() }}
	{{ encore_entry_script_tags('uventecommande') }}

	<!--<script src="{#{ asset('build/runtime.js') }#}"></script>
						                                                                        <script src="{#{ asset('build/tcommandefrscab.js') }#}"></script>-->

{% endblock %}
